{% extends "/html/base_template.html" %}
{% block title %}ASPA {{ season.name }}{% endblock %}
{% block head %}
  {{ super() }}
<style>

.circle-indicator{
    background: none;
    margin: 0 auto;
    box-shadow: none;
    width: 150px;
    height: 150px;
    line-height: 150px;
    position: relative;
}
.circle-indicator:after{
    content: "";
    border-radius: 50%;
    border: 15px solid #f2f5f5;
    position: absolute;
    width: 100%;
    height: 100%;
    top: 0;
    left: 0;
}
.circle-indicator > span{
    position: absolute;
    top: 0;
    z-index: 1;
    width: 50%;
    height: 100%;
    overflow: hidden;
}
.circle-indicator .circle-indicator-left{
    left: 0;
}
.circle-indicator .circle-indicator-bar{
    border-width: 15px;
    border-style: solid;
    position: absolute;
    width: 100%;
    height: 100%;
    background: none;
    top: 0;
    border-color: #26abfd;
}
.circle-indicator .circle-indicator-left .circle-indicator-bar{
    left: 100%;
    border-top-right-radius: 80px;
    border-bottom-right-radius: 80px;
    border-left: 0;
    -webkit-transform-origin: center left;
    transform-origin: center left;
}
.circle-indicator .circle-indicator-right{
    right: 0;
}
.circle-indicator .circle-indicator-right .circle-indicator-bar{
    left: -100%;
    -webkit-transform-origin: center right;
    transform-origin: center right;
    border-top-left-radius: 80px;
    border-bottom-left-radius: 80px;
    border-right: 0;
}
.circle-indicator .circle-indicator-value{
    font-size: 24px;
    text-align: center;
    width: 100%;
    height: 100%;
    position: absolute;
}

</style>
  <script type="text/javascript" charset="utf-8">
  $(document).ready(function() {
    $("#player-summary").tablesorter({
      sortList:[[0,1]],  // sort by date new to old.
      sortAppend: {
        0 : [[ 1, 's' ]]  // sort match number in the same direction as date.
      },
      headers: { },
      widgets: ['zebra'],
      cssAsc: "header-sort-up",
      cssDesc: "header-sort-down"
    });
  });
  </script>
{% endblock %}

{% block header %}
  <h1 class="text-center">American Straight Pool Association</h1>
  {%- if season %}
  <h2 class="text-center">
    {{ season.name }}: {{ season.startDate|datetimeformat('%b %d, %Y') }} to {{ season.endDate|datetimeformat('%b %d, %Y') }}
  </h2>
  {%- endif %}

{% endblock %}

{% block content %}
  <h2 class="text-center">{{ player.firstName }} {{ player.lastName }}</h2>
  {%- if player.photo %}
    <center><p>
    <p>
      <img height="100" src="{{player.photo}}" title="{{ player.firstName }} {{ player.lastName }}"/>
    </p></center>
  {%- endif %}

  <div>
    <h3>Overall</h3>
    <table class="table table-condensed">
      <thead>
        <tr>
          <th class="text-left">Season</th>
          <th class="text-left">Name</th>
          <th class="text-center">H'Cap</th>
          <th class="text-center">Won</th>
          <th class="text-center">Lost</th>
          <th class="text-center">Forfeits</th>
          <th class="text-center">Win %</th>
          <th class="text-center">Points</th>
          <th class="text-center">High Run</th>
          <th class="text-center">Target</th>
          <th class="text-center">% Goal</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td class="test-left">{{season.name}}</td>
          <td class="text-left">{{ player.firstName }} {{ player.lastName }}</td>
          <td class="text-center">{{ summary.handicap }}</td>
          <td class="text-center">{{ summary.wins }}</td>
          <td class="text-center">{{ summary.losses }}</td>
          <td class="text-center">{{ summary.forfeits }}</td>
          <td class="text-center">{{ '%.2f' % summary.pct }}</td>
          <td class="text-center">{{ '%.6f' % summary.points }}</td>
          <td class="text-center">{{ summary.highRun }}</td>
          <td class="text-center">{{ '%.2f' % summary.highRunTarget }}</td>
          <td class="text-center">{{ '%.2f' % summary.goal }}</td>
          <td>
              <div class="circle-indicator">
                    <span class="circle-indicator-left" >
                        <span class="circle-indicator-bar" style="transform: rotate( {% if summary.wins > summary.losses %} {{ summary.wins / (summary.wins + summary.losses) * 360 - 180 }}{%- else -%} 0{%- endif -%}deg)"></span>
                    </span>
                    <span class="circle-indicator-right">
                        <span class="circle-indicator-bar" style="transform: rotate( {% if summary.wins >= summary.losses %} 180{%- else -%} {{ summary.wins / (summary.wins + summary.losses) * 360 }}{%- endif -%}deg)"></span>
                    </span>
                    <div class="circle-indicator-value">{{(summary.wins / (summary.wins + summary.losses) * 100)|round|int}}%</div> 
                </div>
          </td>
        </tr>
     {%- if lifesummary %}
        <tr>
          <td class="test-left">Lifetime</td>
          <td class="text-left">{{ player.firstName }} {{ player.lastName }}</td>
          <td class="text-center">{{ lifesummary.handicap }}</td>
          <td class="text-center">{{ lifesummary.wins }}</td>
          <td class="text-center">{{ lifesummary.losses }}</td>
          <td class="text-center">{{ lifesummary.forfeits }}</td>
          <td class="text-center">{{ '%.2f' % lifesummary.pct }}</td>
          <td class="text-center"></td>
          <td class="text-center">{{ lifesummary.highRun }}</td>
          <td class="text-center">{{ '%.2f' % lifesummary.highRunTarget }}</td>
          <td class="text-center">{{ '%.2f' % lifesummary.goal }}</td>
          <td>
              <div class="circle-indicator">
                    <span class="circle-indicator-left" >
                        <span class="circle-indicator-bar" style="transform: rotate( {% if summary.wins > summary.losses %} {{ summary.wins / (summary.wins + summary.losses) * 360 - 180 }}{%- else -%} 0{%- endif -%}deg)"></span>
                    </span>
                    <span class="circle-indicator-right">
                        <span class="circle-indicator-bar" style="transform: rotate( {% if summary.wins >= summary.losses %} 180{%- else -%} {{ summary.wins / (summary.wins + summary.losses) * 360 }}{%- endif -%}deg)"></span>
                    </span>
                    <div class="circle-indicator-value">{{(summary.wins / (summary.wins + summary.losses) * 100)|round|int}}%</div> 
                </div>
          </td>
        </tr>
     {% endif %}
      </tbody>
    </table>

    <h3>Game by Game</h3>
    <table id="player-summary" class="table table-hover table-condensed sortable-table">
      <thead>
        <tr>
          <th class="sortable-header text-left">Date</th>
          <th class="sortable-header text-left">Match Number</th>
          <th class="sortable-header text-center">Result</th>
          <th class="sortable-header text-center">H'cap</th>
          <th class="sortable-header text-center">Score</th>
          <th class="sortable-header text-center">High Run</th>
          <th class="sortable-header text-center">Win By</th>
          <th class="sortable-header text-center">Lose By</th>
          <th class="text-left">Opponent</th>
          <th class="sortable-header text-center">H'cap</th>
          <th class="sortable-header text-center">Score</th>
          <th class="sortable-header text-center">High Run</th>
          <th class="sortable-header text-center">Video</th>
        </tr>
      </thead>
      <tbody>
      {%- for entry in match_details %}
        <tr>
          <!--
          <td>{{ entry.entry_index }}</td>
          -->
          <td class="text-left"><a href="{{ entry.results_pdf_url }}">{{ entry.date|datetimeformat('%Y-%m-%d') }}</a></td>
          <td class="text-center">{{ entry.seq }}</td>
          <td class="text-center">{{ entry.result }}</td>
          <td class="text-center">{{ entry.player.handicap }}</td>
          <td class="text-center">{{ entry.player.score }} / {{ entry.player.target }}</td>
          <td class="text-center">{{ entry.player.highRun }}</td>
          <td class="text-center">{{ entry.win_mgn }}</td>
          <td class="text-center">{{ entry.lose_mgn }}</td>
          <td class="text-left"><a href="{{ entry.opponent_details_page_url }}">
              {{ entry.opponent.player_obj.firstName }} {{ entry.opponent.player_obj.lastName }}</a></td>
          <td class="text-center">{{ entry.opponent.handicap }}</td>
          <td class="text-center">{{ entry.opponent.score }} / {{ entry.opponent.target }}</td>
          <td class="text-center">{{ entry.opponent.highRun }}</td>

          <td class="text-center" style="vertical-align: middle">
          {%- if entry.video1 %}
            {%- if entry.video2 %}
              <a href="{{ entry.video1 }}" target="video">Part 1</a><br/><a href="{{ entry.video2 }}" target="video">Part 2</a>
            {%- else %}
              <a href="{{ entry.video1 }}" target="video">Video</a>
            {%- endif %}
          {%- else %}
            &nbsp;
          {%- endif %}
          </td>
        </tr>
      {%- endfor %}
      </tbody>
    </table>
  </div>

  <a href="{{charts_page_url}}">Charts</a>
  <a href="/{{club.id()}}/">Home</a>
{%- endblock %}
